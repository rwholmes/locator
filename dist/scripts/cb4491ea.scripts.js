"use strict";angular.module("atmBranchLocatorApp",["ngRoute","app.services.chase","app.services.localStorage","app.map","app.details","app.directives"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/map",{templateUrl:"views/map.html"}).when("/details/:locationName",{templateUrl:"views/details.html"}).otherwise({redirectTo:"/"})}]),angular.module("atmBranchLocatorApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("app.map",[]).controller("MapCtrl",["$scope","Chase","LocalStorage",function(a,b,c){a.chaseLocations=[],navigator.geolocation.getCurrentPosition(function(d){b.getLocations(d.coords.latitude,d.coords.longitude).then(function(b){a.chaseLocations=b.data.locations,c.saveLocations(b.data.locations)})},function(){console.log("geolocation error")})}]),angular.module("app.details",["ngRoute"]).controller("DetailsCtrl",["$scope","$routeParams","LocalStorage",function(a,b,c){var d=b.locationName;a.location=c.getLocationDetails(d)}]),angular.module("app.services.chase",[]).service("Chase",["$http",function(a){this.getLocations=function(b,c){var d="lat="+b,e="&lng="+c,f="https://m.chase.com/PSRWeb/location/list.action?"+d+e;return a({url:f,method:"GET"}).success(function(a){console.log("Chase location query success: ",a)}).error(function(){console.log("Chase location query error")})}}]),angular.module("app.services.localStorage",[]).service("LocalStorage",[function(){this.saveLocations=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d.name]=d}window.localStorage.chaseLocations=JSON.stringify(b)},this.getLocationDetails=function(a){if(window.localStorage.chaseLocations){var b=JSON.parse(window.localStorage.chaseLocations);return b[a]}return{}}}]),angular.module("app.directives",[]).directive("googleMap",["$location",function(a){var b=function(b,c){var d,e,f=[],g=new Boolean,h={center:new google.maps.LatLng(37.775,-122.419),zoom:14},i=function(){void 0===d&&(navigator.geolocation?(g=!0,navigator.geolocation.getCurrentPosition(function(a){b.location?(h.center=new google.maps.LatLng(b.location.lat,b.location.lng),d=new google.maps.Map(c[0],h),j(d,h.center,b.location.label,b.location.label)):(h.center=new google.maps.LatLng(a.coords.latitude,a.coords.longitude),d=new google.maps.Map(c[0],h),j(d,h.center,"User Location","You are here","user"))},function(){a(g)})):(g=!1,a(g)));var a=function(){alert(1==errorFlag?"Geolocation service failed.":"Your browser doesn't support geolocation. We've placed you in San Francisco."),d=new google.maps.Map(c[0],h)}},j=function(c,d,g,h,i){var j,k={position:d,map:c,title:g,icon:"https://maps.google.com/mapfiles/ms/icons/blue-dot.png"};"user"===i&&(k.icon="https://maps.google.com/mapfiles/ms/icons/green-dot.png"),j=new google.maps.Marker(k),f.push(j),google.maps.event.addListener(j,"mouseover",function(){void 0!==e&&e.close();var a={content:h};e=new google.maps.InfoWindow(a),e.open(c,j)}),google.maps.event.addListener(j,"click",function(){var c=this.title;b.$apply(function(){a.path("/details/"+c)})})};b.$watch(function(){return b.chaseLocations},function(){i();for(var a=0;a<f.length;a++)f[a].setMap(null);f=[],j(d,h.center,"User Location","You are here","user"),angular.forEach(b.chaseLocations,function(a){var b=new google.maps.LatLng(a.lat,a.lng),c='<div class="info-window"><h5>CHASE</h5><p>'+a.label+"</br>"+a.address+"</br>"+a.city+", "+a.state+" "+a.zip+"</p><span><strong>Location Type:</strong> "+a.locType.toUpperCase()+'</span></br><a href="#/details/'+a.name+'">Visit Location Page</a></div>';j(d,b,a.name,c)})})};return{restrict:"A",template:'<div class="gmap"></div>',replace:!0,link:b}}]);